{
  "id": "384f28b6-0916-44ff-a98a-80542d96e79a",
  "name": "Query ISBN from MetaDB",
  "description": "",
  "deserializeAs": "DatabaseQueryTask",
  "inputVariables": [
    {
      "key": "timestamp",
      "type": "PROCESS"
    },
    {
      "key": "tenantId",
      "type": "PROCESS"
    }
  ],
  "outputVariable": {},
  "outputPath": "/mnt/workflows/${tenantId}/gobi/isbn-report-${timestamp}.tsv",
  "resultType": "TSV",
  "designation": "metadb",
  "query": "SELECT DISTINCT split_part(identifiers->>'value', ' ', 1) AS isbn FROM folio_inventory.instance instances, jsonb_array_elements(jsonb->'identifiers') identifiers, folio_inventory.holdings_record holdings, folio_inventory.location locations WHERE current_date - cast( instances.\"jsonb\"->'metadata'->>'createdDate' AS date) < 32 AND identifiers->>'identifierTypeId' = '8261054f-be78-422d-bd51-4ed9f33c3422' AND instances.id = holdings.instanceid AND holdings.permanentlocationid = locations.id AND locations.\"jsonb\" ->> 'code' NOT LIKE '%pda%' AND locations.\"jsonb\" ->> 'code' != 'epod'",
  "asyncBefore": true
}
