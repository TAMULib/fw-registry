{
  "id": "c8131f1d-49f7-4096-a06e-23173496b7c6",
  "name": "Update e-resource access",
  "description": "",
  "deserializeAs": "DatabaseQueryTask",
  "inputVariables": [],
  "outputVariable": { },
  "designation": "e-resource",
  "query": "CREATE OR ALTER VIEW {{{e-resource-view}}} AS SELECT DISTINCT uin, tamu_netid, CASE WHEN CAST(emp.BIRTH_DATE AS DATE) <= DATEADD(YEAR, - 18, CAST(GETDATE() AS DATE)) THEN 'true' ELSE 'false' END AS is_over_18 FROM itsql.cis.patron.employees_retirees emp WHERE upper(emp.adloc_system_member_name) IN ('TEXAS A&M AGRILIFE EXTENSION SERVICE', 'TEXAS A&M AGRILIFE RESEARCH', 'TEXAS A&M ENGINEERING EXPERIMENT STATION', 'TEXAS A&M ENGINEERING EXTENSION SERVICE', 'TEXAS A&M FOREST SERVICE', 'TEXAS A&M HEALTH', 'TEXAS A&M SYSTEM OFFICES', 'TEXAS A&M SYSTEM SHARED SERVICE CENTER', 'TEXAS A&M SYSTEM SPONSORED RESEARCH SERVICES', 'TEXAS A&M SYSTEM TECHNOLOGY COMMERCIALIZATION', 'TEXAS A&M TRANSPORTATION INSTITUTE', 'TEXAS A&M UNIVERSITY', 'TEXAS A&M UNIVERSITY AT GALVESTON', 'TEXAS A&M VETERINARY MEDICAL DIAGNOSTIC LABORATORY') AND employment_status_name IN ('Active', 'Working Retiree', 'Leave of Absence', 'Graduate Fellow', 'Future') UNION SELECT DISTINCT uin, tamu_netid, CASE WHEN CAST(emp.BIRTH_DATE AS DATE) <= DATEADD(YEAR, - 18, CAST(GETDATE() AS DATE)) THEN 'true' ELSE 'false' END AS is_over_18 FROM itsql.cis.patron.employees_retirees emp WHERE upper(emp.adloc_system_member_name) IN ('TEXAS A&M AGRILIFE EXTENSION SERVICE', 'TEXAS A&M AGRILIFE RESEARCH', 'TEXAS A&M ENGINEERING EXPERIMENT STATION', 'TEXAS A&M ENGINEERING EXTENSION SERVICE', 'TEXAS A&M FOREST SERVICE', 'TEXAS A&M HEALTH', 'TEXAS A&M SYSTEM OFFICES', 'TEXAS A&M SYSTEM SHARED SERVICE CENTER', 'TEXAS A&M SYSTEM SPONSORED RESEARCH SERVICES', 'TEXAS A&M SYSTEM TECHNOLOGY COMMERCIALIZATION', 'TEXAS A&M TRANSPORTATION INSTITUTE', 'TEXAS A&M UNIVERSITY', 'TEXAS A&M UNIVERSITY AT GALVESTON', 'TEXAS A&M VETERINARY MEDICAL DIAGNOSTIC LABORATORY') AND employment_status_name = 'Retired' AND employee_type_name = 'Faculty' UNION SELECT DISTINCT op.uin, pi.tamu_netid, CASE WHEN CAST(op.BIRTH_DATE AS DATE) <= DATEADD(YEAR, - 18, CAST(GETDATE() AS DATE)) THEN 'true' ELSE 'false' END AS is_over_18 FROM itsql.cis.patron.other_people op LEFT OUTER JOIN itsql.cis.patron.person_identifiers pi ON op.uin = pi.uin WHERE op.data_provider IN ('HSCAFFILIATES', 'QATAR') AND op.affiliate_role IS NULL UNION SELECT DISTINCT op.uin, pi.tamu_netid, CASE WHEN CAST(op.BIRTH_DATE AS DATE) <= DATEADD(YEAR, - 18, CAST(GETDATE() AS DATE)) THEN 'true' ELSE 'false' END AS is_over_18 FROM itsql.cis.patron.other_people op LEFT OUTER JOIN itsql.cis.patron.person_identifiers pi ON op.uin = pi.uin, itsql.cis.patron.employees_retirees emp WHERE op.system_member = emp.adloc_system_member AND affiliate_role IN ('affiliate:remotecollaborator', 'affiliate:continuingeducationstudent', 'affiliate:clinicaltrainee', 'affiliate:faculty:future', 'affiliate:graduateassistant:future', 'affiliate:hsc', 'affiliate:librarian', 'affiliate:medicalresident', 'affiliate:regent', 'affiliate:staff:future', 'affiliate:usda', 'affiliate:veteransprogram', 'affiliate:visitingscholar', 'employee:faculty:retired', 'faculty:adjunct') AND upper(emp.adloc_system_member_name) IN ('TEXAS A&M AGRILIFE EXTENSION SERVICE', 'TEXAS A&M AGRILIFE RESEARCH', 'TEXAS A&M ENGINEERING EXPERIMENT STATION', 'TEXAS A&M ENGINEERING EXTENSION SERVICE', 'TEXAS A&M FOREST SERVICE', 'TEXAS A&M HEALTH', 'TEXAS A&M SYSTEM OFFICES', 'TEXAS A&M SYSTEM SHARED SERVICE CENTER', 'TEXAS A&M SYSTEM SPONSORED RESEARCH SERVICES', 'TEXAS A&M SYSTEM TECHNOLOGY COMMERCIALIZATION', 'TEXAS A&M TRANSPORTATION INSTITUTE', 'TEXAS A&M UNIVERSITY', 'TEXAS A&M UNIVERSITY AT GALVESTON', 'TEXAS A&M VETERINARY MEDICAL DIAGNOSTIC LABORATORY') UNION SELECT DISTINCT stu.uin, tamu_netid, CASE WHEN CAST(stu.BIRTH_DATE AS DATE) <= DATEADD(YEAR, - 18, CAST(GETDATE() AS DATE)) THEN 'true' ELSE 'false' END AS is_over_18 FROM itsql.cis.patron.students stu WHERE enroll_status_name IN ('Enrolled', 'Not Enrolled') UNION SELECT DISTINCT oth.uin AS uin, oth.tamu_netid AS tamu_netid, CASE WHEN CAST(oth.BIRTH_DATE AS DATE) <= DATEADD(YEAR, - 18, CAST(GETDATE() AS DATE)) THEN 'true' ELSE 'false' END AS is_over_18 FROM itsql.cis.patron.library_other_people_exceptions oth;",
  "asyncBefore": true
}
